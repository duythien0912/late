!function(e){"use strict";function s(s){var a=s.find(".os-booking-messages-input"),o=a.val(),n={message:{content:o,author_type:s.data("author-type"),booking_id:s.data("booking-id")}},i={action:"latepoint_route_call",route_name:s.data("route"),params:n,return_format:"json"};s.find(".latepoint-btn").addClass("os-loading"),e(".booking-messages-list").find(".os-bm-no-messages").remove();var l=s.data("avatar-url");return e(".booking-messages-list").append('<div class="os-booking-message-w os-bm-customer"><div class="os-booking-message">'+o+'</div><div class="os-bm-info-w"><div class="os-bm-avatar" style="background-image:url('+l+');"></div><div class="os-bm-date">'+latepoint_helper.string_today+"</div></div></div>"),t(),a.val(""),e.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:i,success:function(e){s.removeClass("os-is-typing"),s.find(".latepoint-btn").removeClass("os-loading"),"success"===e.status||(a.val(o),alert(e.message))}}),!1}function t(){jQuery(".booking-messages-list").scrollTop(jQuery(".booking-messages-list")[0].scrollHeight)}function a(s,a){var o=e(".latepoint-chat-box-w");a&&o.addClass("os-loading");var n={action:"latepoint_route_call",route_name:o.data("route"),params:{booking_id:s,viewer_user_type:"customer"},return_format:"json"};e.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:n,success:function(n){a&&o.removeClass("os-loading"),"success"===n.status?(o.find(".booking-messages-list").html(n.message),t(),e(".os-booking-messages-input-w").data("booking-id",s)):alert(n.message)}})}e(function(){e(".lc-conversation").on("click",function(){var s=e(this).data("booking-id");return e(".lc-conversation.lc-selected").removeClass("lc-selected"),e(this).addClass("lc-selected"),a(s,!0),!1}),clearInterval(latepoint_helper.latepoint_message_refresh_timer),e(".latepoint-chat-box-w").length&&e(".lc-conversation").length&&(latepoint_helper.latepoint_message_refresh_timer=setInterval(function(){if(!document.hidden){var s={action:"latepoint_route_call",route_name:e(".latepoint-chat-box-w").data("check-unread-route"),params:{booking_id:e(".lc-conversation.lc-selected").data("booking-id"),viewer_user_type:"customer"},return_format:"json"};e.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:s,success:function(s){"success"===s.status&&"yes"==s.message&&a(e(".lc-conversation.lc-selected").data("booking-id"),!1)}})}},3e3)),e(".os-bm-send-btn").on("click",function(t){return s(e(this).closest(".os-booking-messages-input-w")),!1}),e(".os-booking-messages-input").on("keyup",function(t){var a=e(this),o=a.closest(".os-booking-messages-input-w");if(13==t.keyCode)return t.preventDefault(),s(o),!1;a.val()?o.addClass("os-is-typing"):o.removeClass("os-is-typing")}),e(".latepoint-trigger-messages-tab").on("click",function(){a(e(".lc-conversation.lc-selected").data("booking-id"),!1)})})}(jQuery);
//# sourceMappingURL=latepoint-messages-front.js.map